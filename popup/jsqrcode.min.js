(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t():typeof define==="function"&&define.amd?define(t):e.QrCode=t()})(this,function(){"use strict";function e(e,t,r){this.ordinal_Renamed_Field=e;this.bits=t;this.name=r}e.prototype.ordinal=function(){return this.ordinal_Renamed_Field};e.forBits=function(e){if(e<0||e>=t.length){throw"ArgumentException"}return t[e]};var t=[new e(1,0,"M"),new e(0,1,"L"),new e(3,2,"H"),new e(2,3,"Q")];var r=21522;var i=[[21522,0],[20773,1],[24188,2],[23371,3],[17913,4],[16590,5],[20375,6],[19104,7],[30660,8],[29427,9],[32170,10],[30877,11],[26159,12],[25368,13],[27713,14],[26998,15],[5769,16],[5054,17],[7399,18],[6608,19],[1890,20],[597,21],[3340,22],[2107,23],[13663,24],[12392,25],[16177,26],[14854,27],[9396,28],[8579,29],[11994,30],[11245,31]];var n=[0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4];function a(t){this.errorCorrectionLevel=e.forBits(t>>3&3);this.dataMask=t&7}a.prototype.GetHashCode=function(){return this.errorCorrectionLevel.ordinal()<<3|this.dataMask};a.prototype.Equals=function(e){var t=e;return this.errorCorrectionLevel==t.errorCorrectionLevel&&this.dataMask==t.dataMask};a.numBitsDiffering=function(e,t){e^=t;return n[e&15]+n[q(e,4)&15]+n[q(e,8)&15]+n[q(e,12)&15]+n[q(e,16)&15]+n[q(e,20)&15]+n[q(e,24)&15]+n[q(e,28)&15]};a.decodeFormatInformation=function(e){var t=a.doDecodeFormatInformation(e);if(t!=null){return t}return a.doDecodeFormatInformation(e^r)};a.doDecodeFormatInformation=function(e){var t=4294967295;var r=0;for(var n=0;n<i.length;n++){var o=i[n];var s=o[0];if(s==e){return new a(o[1])}var h=this.numBitsDiffering(e,s);if(h<t){r=o[1];t=h}}if(t<=3){return new a(r)}return null};function o(e,t){if(!t)t=e;if(e<1||t<1){throw"Both dimensions must be greater than 0"}this.width=e;this.height=t;var r=e>>5;if((e&31)!=0){r++}this.rowSize=r;this.bits=new Array(r*t);for(var i=0;i<this.bits.length;i++)this.bits[i]=0}Object.defineProperty(o.prototype,"Dimension",{get:function(){if(this.width!=this.height){throw"Can't call getDimension() on a non-square matrix"}return this.width}});o.prototype.get_Renamed=function(e,t){var r=t*this.rowSize+(e>>5);return(q(this.bits[r],e&31)&1)!=0};o.prototype.set_Renamed=function(e,t){var r=t*this.rowSize+(e>>5);this.bits[r]|=1<<(e&31)};o.prototype.flip=function(e,t){var r=t*this.rowSize+(e>>5);this.bits[r]^=1<<(e&31)};o.prototype.clear=function(){var e=this.bits.length;for(var t=0;t<e;t++){this.bits[t]=0}};o.prototype.setRegion=function(e,t,r,i){if(t<0||e<0){throw"Left and top must be nonnegative"}if(i<1||r<1){throw"Height and width must be at least 1"}var n=e+r;var a=t+i;if(a>this.height||n>this.width){throw"The region must fit inside the matrix"}for(var o=t;o<a;o++){var s=o*this.rowSize;for(var h=e;h<n;h++){this.bits[s+(h>>5)]|=1<<(h&31)}}};function s(e,t){this.count=e;this.dataCodewords=t}function h(e,t,r){this.ecCodewordsPerBlock=e;if(r)this.ecBlocks=[t,r];else this.ecBlocks=[t]}Object.defineProperty(h.prototype,"TotalECCodewords",{get:function(){return this.ecCodewordsPerBlock*this.NumBlocks}});Object.defineProperty(h.prototype,"NumBlocks",{get:function(){var e=0;for(var t=0;t<this.ecBlocks.length;t++){e+=this.ecBlocks[t].length}return e}});h.prototype.getECBlocks=function(){return this.ecBlocks};function f(e,t,r,i,n,a){this.versionNumber=e;this.alignmentPatternCenters=t;this.ecBlocks=[r,i,n,a];var o=0;var s=r.ecCodewordsPerBlock;var h=r.getECBlocks();for(var f=0;f<h.length;f++){var w=h[f];o+=w.count*(w.dataCodewords+s)}this.totalCodewords=o}Object.defineProperty(f.prototype,"DimensionForVersion",{get:function(){return 17+4*this.versionNumber}});f.prototype.buildFunctionPattern=function(){var e=this.DimensionForVersion;var t=new o(e);t.setRegion(0,0,9,9);t.setRegion(e-8,0,8,9);t.setRegion(0,e-8,9,8);var r=this.alignmentPatternCenters.length;for(var i=0;i<r;i++){var n=this.alignmentPatternCenters[i]-2;for(var a=0;a<r;a++){if(i==0&&(a==0||a==r-1)||i==r-1&&a==0){continue}t.setRegion(this.alignmentPatternCenters[a]-2,n,5,5)}}t.setRegion(6,9,1,e-17);t.setRegion(9,6,e-17,1);if(this.versionNumber>6){t.setRegion(e-11,0,3,6);t.setRegion(0,e-11,6,3)}return t};f.prototype.getECBlocksForLevel=function(e){return this.ecBlocks[e.ordinal()]};f.VERSION_DECODE_INFO=[31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017];f.VERSIONS=w();f.getVersionForNumber=function(e){if(e<1||e>40){throw"ArgumentException"}return f.VERSIONS[e-1]};f.getProvisionalVersionForDimension=function(e){if(e%4!=1){throw"Error getProvisionalVersionForDimension"}try{return f.getVersionForNumber(e-17>>2)}catch(t){throw"Error getVersionForNumber"}};f.decodeVersionInformation=function(e){var t=4294967295;var r=0;for(var i=0;i<f.VERSION_DECODE_INFO.length;i++){var n=f.VERSION_DECODE_INFO[i];if(n==e){return this.getVersionForNumber(i+7)}var o=a.numBitsDiffering(e,n);if(o<t){r=i+7;t=o}}if(t<=3){return this.getVersionForNumber(r)}return null};function w(){return[new f(1,[],new h(7,new s(1,19)),new h(10,new s(1,16)),new h(13,new s(1,13)),new h(17,new s(1,9))),new f(2,[6,18],new h(10,new s(1,34)),new h(16,new s(1,28)),new h(22,new s(1,22)),new h(28,new s(1,16))),new f(3,[6,22],new h(15,new s(1,55)),new h(26,new s(1,44)),new h(18,new s(2,17)),new h(22,new s(2,13))),new f(4,[6,26],new h(20,new s(1,80)),new h(18,new s(2,32)),new h(26,new s(2,24)),new h(16,new s(4,9))),new f(5,[6,30],new h(26,new s(1,108)),new h(24,new s(2,43)),new h(18,new s(2,15),new s(2,16)),new h(22,new s(2,11),new s(2,12))),new f(6,[6,34],new h(18,new s(2,68)),new h(16,new s(4,27)),new h(24,new s(4,19)),new h(28,new s(4,15))),new f(7,[6,22,38],new h(20,new s(2,78)),new h(18,new s(4,31)),new h(18,new s(2,14),new s(4,15)),new h(26,new s(4,13),new s(1,14))),new f(8,[6,24,42],new h(24,new s(2,97)),new h(22,new s(2,38),new s(2,39)),new h(22,new s(4,18),new s(2,19)),new h(26,new s(4,14),new s(2,15))),new f(9,[6,26,46],new h(30,new s(2,116)),new h(22,new s(3,36),new s(2,37)),new h(20,new s(4,16),new s(4,17)),new h(24,new s(4,12),new s(4,13))),new f(10,[6,28,50],new h(18,new s(2,68),new s(2,69)),new h(26,new s(4,43),new s(1,44)),new h(24,new s(6,19),new s(2,20)),new h(28,new s(6,15),new s(2,16))),new f(11,[6,30,54],new h(20,new s(4,81)),new h(30,new s(1,50),new s(4,51)),new h(28,new s(4,22),new s(4,23)),new h(24,new s(3,12),new s(8,13))),new f(12,[6,32,58],new h(24,new s(2,92),new s(2,93)),new h(22,new s(6,36),new s(2,37)),new h(26,new s(4,20),new s(6,21)),new h(28,new s(7,14),new s(4,15))),new f(13,[6,34,62],new h(26,new s(4,107)),new h(22,new s(8,37),new s(1,38)),new h(24,new s(8,20),new s(4,21)),new h(22,new s(12,11),new s(4,12))),new f(14,[6,26,46,66],new h(30,new s(3,115),new s(1,116)),new h(24,new s(4,40),new s(5,41)),new h(20,new s(11,16),new s(5,17)),new h(24,new s(11,12),new s(5,13))),new f(15,[6,26,48,70],new h(22,new s(5,87),new s(1,88)),new h(24,new s(5,41),new s(5,42)),new h(30,new s(5,24),new s(7,25)),new h(24,new s(11,12),new s(7,13))),new f(16,[6,26,50,74],new h(24,new s(5,98),new s(1,99)),new h(28,new s(7,45),new s(3,46)),new h(24,new s(15,19),new s(2,20)),new h(30,new s(3,15),new s(13,16))),new f(17,[6,30,54,78],new h(28,new s(1,107),new s(5,108)),new h(28,new s(10,46),new s(1,47)),new h(28,new s(1,22),new s(15,23)),new h(28,new s(2,14),new s(17,15))),new f(18,[6,30,56,82],new h(30,new s(5,120),new s(1,121)),new h(26,new s(9,43),new s(4,44)),new h(28,new s(17,22),new s(1,23)),new h(28,new s(2,14),new s(19,15))),new f(19,[6,30,58,86],new h(28,new s(3,113),new s(4,114)),new h(26,new s(3,44),new s(11,45)),new h(26,new s(17,21),new s(4,22)),new h(26,new s(9,13),new s(16,14))),new f(20,[6,34,62,90],new h(28,new s(3,107),new s(5,108)),new h(26,new s(3,41),new s(13,42)),new h(30,new s(15,24),new s(5,25)),new h(28,new s(15,15),new s(10,16))),new f(21,[6,28,50,72,94],new h(28,new s(4,116),new s(4,117)),new h(26,new s(17,42)),new h(28,new s(17,22),new s(6,23)),new h(30,new s(19,16),new s(6,17))),new f(22,[6,26,50,74,98],new h(28,new s(2,111),new s(7,112)),new h(28,new s(17,46)),new h(30,new s(7,24),new s(16,25)),new h(24,new s(34,13))),new f(23,[6,30,54,74,102],new h(30,new s(4,121),new s(5,122)),new h(28,new s(4,47),new s(14,48)),new h(30,new s(11,24),new s(14,25)),new h(30,new s(16,15),new s(14,16))),new f(24,[6,28,54,80,106],new h(30,new s(6,117),new s(4,118)),new h(28,new s(6,45),new s(14,46)),new h(30,new s(11,24),new s(16,25)),new h(30,new s(30,16),new s(2,17))),new f(25,[6,32,58,84,110],new h(26,new s(8,106),new s(4,107)),new h(28,new s(8,47),new s(13,48)),new h(30,new s(7,24),new s(22,25)),new h(30,new s(22,15),new s(13,16))),new f(26,[6,30,58,86,114],new h(28,new s(10,114),new s(2,115)),new h(28,new s(19,46),new s(4,47)),new h(28,new s(28,22),new s(6,23)),new h(30,new s(33,16),new s(4,17))),new f(27,[6,34,62,90,118],new h(30,new s(8,122),new s(4,123)),new h(28,new s(22,45),new s(3,46)),new h(30,new s(8,23),new s(26,24)),new h(30,new s(12,15),new s(28,16))),new f(28,[6,26,50,74,98,122],new h(30,new s(3,117),new s(10,118)),new h(28,new s(3,45),new s(23,46)),new h(30,new s(4,24),new s(31,25)),new h(30,new s(11,15),new s(31,16))),new f(29,[6,30,54,78,102,126],new h(30,new s(7,116),new s(7,117)),new h(28,new s(21,45),new s(7,46)),new h(30,new s(1,23),new s(37,24)),new h(30,new s(19,15),new s(26,16))),new f(30,[6,26,52,78,104,130],new h(30,new s(5,115),new s(10,116)),new h(28,new s(19,47),new s(10,48)),new h(30,new s(15,24),new s(25,25)),new h(30,new s(23,15),new s(25,16))),new f(31,[6,30,56,82,108,134],new h(30,new s(13,115),new s(3,116)),new h(28,new s(2,46),new s(29,47)),new h(30,new s(42,24),new s(1,25)),new h(30,new s(23,15),new s(28,16))),new f(32,[6,34,60,86,112,138],new h(30,new s(17,115)),new h(28,new s(10,46),new s(23,47)),new h(30,new s(10,24),new s(35,25)),new h(30,new s(19,15),new s(35,16))),new f(33,[6,30,58,86,114,142],new h(30,new s(17,115),new s(1,116)),new h(28,new s(14,46),new s(21,47)),new h(30,new s(29,24),new s(19,25)),new h(30,new s(11,15),new s(46,16))),new f(34,[6,34,62,90,118,146],new h(30,new s(13,115),new s(6,116)),new h(28,new s(14,46),new s(23,47)),new h(30,new s(44,24),new s(7,25)),new h(30,new s(59,16),new s(1,17))),new f(35,[6,30,54,78,102,126,150],new h(30,new s(12,121),new s(7,122)),new h(28,new s(12,47),new s(26,48)),new h(30,new s(39,24),new s(14,25)),new h(30,new s(22,15),new s(41,16))),new f(36,[6,24,50,76,102,128,154],new h(30,new s(6,121),new s(14,122)),new h(28,new s(6,47),new s(34,48)),new h(30,new s(46,24),new s(10,25)),new h(30,new s(2,15),new s(64,16))),new f(37,[6,28,54,80,106,132,158],new h(30,new s(17,122),new s(4,123)),new h(28,new s(29,46),new s(14,47)),new h(30,new s(49,24),new s(10,25)),new h(30,new s(24,15),new s(46,16))),new f(38,[6,32,58,84,110,136,162],new h(30,new s(4,122),new s(18,123)),new h(28,new s(13,46),new s(32,47)),new h(30,new s(48,24),new s(14,25)),new h(30,new s(42,15),new s(32,16))),new f(39,[6,26,54,82,110,138,166],new h(30,new s(20,117),new s(4,118)),new h(28,new s(40,47),new s(7,48)),new h(30,new s(43,24),new s(22,25)),new h(30,new s(10,15),new s(67,16))),new f(40,[6,30,58,86,114,142,170],new h(30,new s(19,118),new s(6,119)),new h(28,new s(18,47),new s(31,48)),new h(30,new s(34,24),new s(34,25)),new h(30,new s(20,15),new s(61,16)))]}function l(e,t,r){this.x=e;this.y=t;this.count=1;this.estimatedModuleSize=r}Object.defineProperty(l.prototype,"X",{get:function(){return Math.floor(this.x)}});Object.defineProperty(l.prototype,"Y",{get:function(){return Math.floor(this.y)}});l.prototype.incrementCount=function(){this.count++};l.prototype.aboutEquals=function(e,t,r){if(Math.abs(t-this.y)<=e&&Math.abs(r-this.x)<=e){var i=Math.abs(e-this.estimatedModuleSize);return i<=1||i/this.estimatedModuleSize<=1}return false};function u(e,t,r,i,n,a,o){this.image=e;this.possibleCenters=[];this.startX=t;this.startY=r;this.width=i;this.height=n;this.moduleSize=a;this.crossCheckStateCount=[0,0,0];this.resultPointCallback=o}u.prototype.centerFromEnd=function(e,t){return t-e[2]-e[1]/2};u.prototype.foundPatternCross=function(e){var t=this.moduleSize;var r=t/2;for(var i=0;i<3;i++){if(Math.abs(t-e[i])>=r){return false}}return true};u.prototype.crossCheckVertical=function(e,t,r,i){var n=this.image;var a=n.height;var o=this.crossCheckStateCount;o[0]=0;o[1]=0;o[2]=0;var s=e;while(s>=0&&n.data[t+s*n.width]&&o[1]<=r){o[1]++;s--}if(s<0||o[1]>r){return NaN}while(s>=0&&!n.data[t+s*n.width]&&o[0]<=r){o[0]++;s--}if(o[0]>r){return NaN}s=e+1;while(s<a&&n.data[t+s*n.width]&&o[1]<=r){o[1]++;s++}if(s==a||o[1]>r){return NaN}while(s<a&&!n.data[t+s*n.width]&&o[2]<=r){o[2]++;s++}if(o[2]>r){return NaN}var h=o[0]+o[1]+o[2];if(5*Math.abs(h-i)>=2*i){return NaN}return this.foundPatternCross(o)?this.centerFromEnd(o,s):NaN};u.prototype.handlePossibleCenter=function(e,t,r){var i=e[0]+e[1]+e[2];var n=this.centerFromEnd(e,r);var a=this.crossCheckVertical(t,Math.floor(n),2*e[1],i);if(!isNaN(a)){var o=(e[0]+e[1]+e[2])/3;var s=this.possibleCenters.length;for(var h=0;h<s;h++){var f=this.possibleCenters[h];if(f.aboutEquals(o,a,n)){return new l(n,a,o)}}var w=new l(n,a,o);this.possibleCenters.push(w);if(this.resultPointCallback!=null){this.resultPointCallback.foundPossibleResultPoint(w)}}return null};u.prototype.find=function(){var e=this.image;var t=this.startX;var r=this.height;var i=t+this.width;var n=this.startY+(r>>1);var a=[0,0,0];for(var o=0;o<r;o++){var s=n+((o&1)==0?o+1>>1:-(o+1>>1));a[0]=0;a[1]=0;a[2]=0;var h=t;while(h<i&&!e.data[h+e.width*s]){h++}var f=0;while(h<i){if(e.data[h+s*e.width]){if(f==1){a[f]++}else{if(f==2){if(this.foundPatternCross(a)){var w=this.handlePossibleCenter(a,s,h);if(w!=null){return w}}a[0]=a[2];a[1]=1;a[2]=0;f=1}else{a[++f]++}}}else{if(f==1){f++}a[f]++}h++}if(this.foundPatternCross(a)){var w=this.handlePossibleCenter(a,s,i);if(w!=null){return w}}}if(!(this.possibleCenters.length==0)){return this.possibleCenters[0]}throw"Couldn't find enough alignment patterns"};var d={};d.checkAndNudgePoints=function(e,t){var r=e.width;var i=e.height;var n=true;for(var a=0;a<t.length&&n;a+=2){var o=Math.floor(t[a]);var s=Math.floor(t[a+1]);if(o<-1||o>r||s<-1||s>i){throw"Error.checkAndNudgePoints "}n=false;if(o==-1){t[a]=0;n=true}else if(o==r){t[a]=r-1;n=true}if(s==-1){t[a+1]=0;n=true}else if(s==i){t[a+1]=i-1;n=true}}n=true;for(var a=t.length-2;a>=0&&n;a-=2){var o=Math.floor(t[a]);var s=Math.floor(t[a+1]);if(o<-1||o>r||s<-1||s>i){throw"Error.checkAndNudgePoints "}n=false;if(o==-1){t[a]=0;n=true}else if(o==r){t[a]=r-1;n=true}if(s==-1){t[a+1]=0;n=true}else if(s==i){t[a+1]=i-1;n=true}}};d.sampleGrid3=function(e,t,r){var i=new o(t);var n=new Array(t<<1);for(var a=0;a<t;a++){var s=n.length;var h=a+.5;for(var f=0;f<s;f+=2){n[f]=(f>>1)+.5;n[f+1]=h}r.transformPoints1(n);d.checkAndNudgePoints(e,n);try{for(var f=0;f<s;f+=2){var w=e.data[Math.floor(n[f])+e.width*Math.floor(n[f+1])];if(w)i.set_Renamed(f>>1,a)}}catch(l){throw"Error.checkAndNudgePoints"}}return i};var v=3;var c=57;var p=8;var g=2;function m(e){function t(e,t){var r=e.X-t.X;var i=e.Y-t.Y;return Math.sqrt(r*r+i*i)}function r(e,t,r){var i=t.x;var n=t.y;return(r.x-i)*(e.y-n)-(r.y-n)*(e.x-i)}var i=t(e[0],e[1]);var n=t(e[1],e[2]);var a=t(e[0],e[2]);var o,s,h;if(n>=i&&n>=a){s=e[0];o=e[1];h=e[2]}else if(a>=n&&a>=i){s=e[1];o=e[0];h=e[2]}else{s=e[2];o=e[0];h=e[1]}if(r(o,s,h)<0){var f=o;o=h;h=f}e[0]=o;e[1]=s;e[2]=h}function b(e,t,r){this.x=e;this.y=t;this.count=1;this.estimatedModuleSize=r}Object.defineProperty(b.prototype,"X",{get:function(){return this.x}});Object.defineProperty(b.prototype,"Y",{get:function(){return this.y}});b.prototype.incrementCount=function(){this.count++};b.prototype.aboutEquals=function(e,t,r){if(Math.abs(t-this.y)<=e&&Math.abs(r-this.x)<=e){var i=Math.abs(e-this.estimatedModuleSize);return i<=1||i/this.estimatedModuleSize<=1}return false};function y(e){this.bottomLeft=e[0];this.topLeft=e[1];this.topRight=e[2]}function C(){this.image=null;this.possibleCenters=[];this.hasSkipped=false;this.crossCheckStateCount=[0,0,0,0,0];this.resultPointCallback=null}Object.defineProperty(C.prototype,"CrossCheckStateCount",{get:function(){this.crossCheckStateCount[0]=0;this.crossCheckStateCount[1]=0;this.crossCheckStateCount[2]=0;this.crossCheckStateCount[3]=0;this.crossCheckStateCount[4]=0;return this.crossCheckStateCount}});C.prototype.foundPatternCross=function(e){var t=0;for(var r=0;r<5;r++){var i=e[r];if(i==0){return false}t+=i}if(t<7){return false}var n=Math.floor((t<<p)/7);var a=Math.floor(n/2);return Math.abs(n-(e[0]<<p))<a&&Math.abs(n-(e[1]<<p))<a&&Math.abs(3*n-(e[2]<<p))<3*a&&Math.abs(n-(e[3]<<p))<a&&Math.abs(n-(e[4]<<p))<a};C.prototype.centerFromEnd=function(e,t){return t-e[4]-e[3]-e[2]/2};C.prototype.crossCheckVertical=function(e,t,r,i){var n=this.image;var a=n.height;var o=this.CrossCheckStateCount;var s=e;while(s>=0&&n.data[t+s*n.width]){o[2]++;s--}if(s<0){return NaN}while(s>=0&&!n.data[t+s*n.width]&&o[1]<=r){o[1]++;s--}if(s<0||o[1]>r){return NaN}while(s>=0&&n.data[t+s*n.width]&&o[0]<=r){o[0]++;s--}if(o[0]>r){return NaN}s=e+1;while(s<a&&n.data[t+s*n.width]){o[2]++;s++}if(s==a){return NaN}while(s<a&&!n.data[t+s*n.width]&&o[3]<r){o[3]++;s++}if(s==a||o[3]>=r){return NaN}while(s<a&&n.data[t+s*n.width]&&o[4]<r){o[4]++;s++}if(o[4]>=r){return NaN}var h=o[0]+o[1]+o[2]+o[3]+o[4];if(5*Math.abs(h-i)>=2*i){return NaN}return this.foundPatternCross(o)?this.centerFromEnd(o,s):NaN};C.prototype.crossCheckHorizontal=function(e,t,r,i){var n=this.image;var a=n.width;var o=this.CrossCheckStateCount;var s=e;while(s>=0&&n.data[s+t*n.width]){o[2]++;s--}if(s<0){return NaN}while(s>=0&&!n.data[s+t*n.width]&&o[1]<=r){o[1]++;s--}if(s<0||o[1]>r){return NaN}while(s>=0&&n.data[s+t*n.width]&&o[0]<=r){o[0]++;s--}if(o[0]>r){return NaN}s=e+1;while(s<a&&n.data[s+t*n.width]){o[2]++;s++}if(s==a){return NaN}while(s<a&&!n.data[s+t*n.width]&&o[3]<r){o[3]++;s++}if(s==a||o[3]>=r){return NaN}while(s<a&&n.data[s+t*n.width]&&o[4]<r){o[4]++;s++}if(o[4]>=r){return NaN}var h=o[0]+o[1]+o[2]+o[3]+o[4];if(5*Math.abs(h-i)>=i){return NaN}return this.foundPatternCross(o)?this.centerFromEnd(o,s):NaN};C.prototype.handlePossibleCenter=function(e,t,r){var i=e[0]+e[1]+e[2]+e[3]+e[4];var n=this.centerFromEnd(e,r);var a=this.crossCheckVertical(t,Math.floor(n),e[2],i);if(!isNaN(a)){n=this.crossCheckHorizontal(Math.floor(n),Math.floor(a),e[2],i);if(!isNaN(n)){var o=i/7;var s=false;var h=this.possibleCenters.length;for(var f=0;f<h;f++){var w=this.possibleCenters[f];if(w.aboutEquals(o,a,n)){w.incrementCount();s=true;break}}if(!s){var l=new b(n,a,o);this.possibleCenters.push(l);if(this.resultPointCallback!=null){this.resultPointCallback.foundPossibleResultPoint(l)}}return true}}return false};C.prototype.selectBestPatterns=function(){var e=this.possibleCenters.length;if(e<3){throw"Couldn't find enough finder patterns:"+e+" patterns found"}if(e>3){var t=0;var r=0;for(var i=0;i<e;i++){var n=this.possibleCenters[i].estimatedModuleSize;t+=n;r+=n*n}var a=t/e;this.possibleCenters.sort(function(e,t){var r=Math.abs(t.estimatedModuleSize-a);var i=Math.abs(e.estimatedModuleSize-a);if(r<i){return-1}else if(r==i){return 0}else{return 1}});var o=Math.sqrt(r/e-a*a);var s=Math.max(.2*a,o);for(var i=this.possibleCenters-1;i>=0;i--){var h=this.possibleCenters[i];if(Math.abs(h.estimatedModuleSize-a)>s){this.possibleCenters.splice(i,1)}}}if(this.possibleCenters.length>3){this.possibleCenters.sort(function(e,t){if(e.count>t.count)return-1;if(e.count<t.count)return 1;return 0})}return[this.possibleCenters[0],this.possibleCenters[1],this.possibleCenters[2]]};C.prototype.findRowSkip=function(){var e=this.possibleCenters.length;if(e<=1){return 0}var t=null;for(var r=0;r<e;r++){var i=this.possibleCenters[r];if(i.count>=g){if(t==null){t=i}else{this.hasSkipped=true;return Math.floor((Math.abs(t.X-i.X)-Math.abs(t.Y-i.Y))/2)}}}return 0};C.prototype.haveMultiplyConfirmedCenters=function(){var e=0;var t=0;var r=this.possibleCenters.length;for(var i=0;i<r;i++){var n=this.possibleCenters[i];if(n.count>=g){e++;t+=n.estimatedModuleSize}}if(e<3){return false}var a=t/r;var o=0;for(var i=0;i<r;i++){n=this.possibleCenters[i];o+=Math.abs(n.estimatedModuleSize-a)}return o<=.05*t};C.prototype.findFinderPattern=function(e){var t=false;this.image=e;var r=e.height;var i=e.width;var n=Math.floor(3*r/(4*c));if(n<v||t){n=v}var a=false;var o=new Array(5);for(var s=n-1;s<r&&!a;s+=n){o[0]=0;o[1]=0;o[2]=0;o[3]=0;o[4]=0;var h=0;for(var f=0;f<i;f++){if(e.data[f+s*e.width]){if((h&1)==1){h++}o[h]++}else{if((h&1)==0){if(h==4){if(this.foundPatternCross(o)){var w=this.handlePossibleCenter(o,s,f);if(w){n=2;if(this.hasSkipped){a=this.haveMultiplyConfirmedCenters()}else{var l=this.findRowSkip();if(l>o[2]){s+=l-o[2]-n;f=i-1}}}else{do{f++}while(f<i&&!e.data[f+s*e.width]);f--}h=0;o[0]=0;o[1]=0;o[2]=0;o[3]=0;o[4]=0}else{o[0]=o[2];o[1]=o[3];o[2]=o[4];o[3]=1;o[4]=0;h=3}}else{o[++h]++}}else{o[h]++}}}if(this.foundPatternCross(o)){var w=this.handlePossibleCenter(o,s,i);if(w){n=o[0];if(this.hasSkipped){a=this.haveMultiplyConfirmedCenters()}}}}var u=this.selectBestPatterns();m(u);return new y(u)};function M(e,t,r,i,n,a,o,s,h){this.a11=e;this.a12=i;this.a13=o;this.a21=t;this.a22=n;this.a23=s;this.a31=r;this.a32=a;this.a33=h}M.prototype.transformPoints1=function(e){var t=e.length;var r=this.a11;var i=this.a12;var n=this.a13;var a=this.a21;var o=this.a22;var s=this.a23;var h=this.a31;var f=this.a32;var w=this.a33;for(var l=0;l<t;l+=2){var u=e[l];var d=e[l+1];var v=n*u+s*d+w;e[l]=(r*u+a*d+h)/v;e[l+1]=(i*u+o*d+f)/v}};M.prototype.transformPoints2=function(e,t){var r=e.length;for(var i=0;i<r;i++){var n=e[i];var a=t[i];var o=this.a13*n+this.a23*a+this.a33;e[i]=(this.a11*n+this.a21*a+this.a31)/o;t[i]=(this.a12*n+this.a22*a+this.a32)/o}};M.prototype.buildAdjoint=function(){return new M(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)};M.prototype.times=function(e){return new M(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)};M.quadrilateralToQuadrilateral=function(e,t,r,i,n,a,o,s,h,f,w,l,u,d,v,c){var p=this.quadrilateralToSquare(e,t,r,i,n,a,o,s);var g=this.squareToQuadrilateral(h,f,w,l,u,d,v,c);return g.times(p)};M.squareToQuadrilateral=function(e,t,r,i,n,a,o,s){var h=s-a;var f=t-i+a-s;if(h==0&&f==0){return new M(r-e,n-r,e,i-t,a-i,t,0,0,1)}else{var w=r-n;var l=o-n;var u=e-r+n-o;var d=i-a;var v=w*h-l*d;var c=(u*h-l*f)/v;var p=(w*f-u*d)/v;return new M(r-e+c*r,o-e+p*o,e,i-t+c*i,s-t+p*s,t,c,p,1)}};M.quadrilateralToSquare=function(e,t,r,i,n,a,o,s){return this.squareToQuadrilateral(e,t,r,i,n,a,o,s).buildAdjoint()};function k(e,t){this.bits=e;this.points=t}function P(e){this.image=e;this.resultPointCallback=null}P.prototype.sizeOfBlackWhiteBlackRun=function(e,t,r,i){var n=Math.abs(i-t)>Math.abs(r-e);if(n){var a=e;e=t;t=a;a=r;r=i;i=a}var o=Math.abs(r-e);var s=Math.abs(i-t);var h=-o>>1;var f=t<i?1:-1;var w=e<r?1:-1;var l=0;for(var u=e,d=t;u!=r;u+=w){var v=n?d:u;var c=n?u:d;if(l==1){if(this.image.data[v+c*this.image.width]){l++}}else{if(!this.image.data[v+c*this.image.width]){l++}}if(l==3){var p=u-e;var g=d-t;return Math.sqrt(p*p+g*g)}h+=s;if(h>0){if(d==i){break}d+=f;h-=o}}var m=r-e;var b=i-t;return Math.sqrt(m*m+b*b)};P.prototype.sizeOfBlackWhiteBlackRunBothWays=function(e,t,r,i){var n=this.sizeOfBlackWhiteBlackRun(e,t,r,i);var a=1;var o=e-(r-e);if(o<0){a=e/(e-o);o=0}else if(o>=this.image.width){a=(this.image.width-1-e)/(o-e);o=this.image.width-1}var s=Math.floor(t-(i-t)*a);a=1;if(s<0){a=t/(t-s);s=0}else if(s>=this.image.height){a=(this.image.height-1-t)/(s-t);s=this.image.height-1}o=Math.floor(e+(o-e)*a);n+=this.sizeOfBlackWhiteBlackRun(e,t,o,s);return n-1};P.prototype.calculateModuleSizeOneWay=function(e,t){var r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.X),Math.floor(e.Y),Math.floor(t.X),Math.floor(t.Y));var i=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.X),Math.floor(t.Y),Math.floor(e.X),Math.floor(e.Y));if(isNaN(r)){return i/7}if(isNaN(i)){return r/7}return(r+i)/14};P.prototype.calculateModuleSize=function(e,t,r){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,r))/2};P.prototype.distance=function(e,t){var r=e.X-t.X;var i=e.Y-t.Y;return Math.sqrt(r*r+i*i)};P.prototype.computeDimension=function(e,t,r,i){var n=Math.round(this.distance(e,t)/i);var a=Math.round(this.distance(e,r)/i);var o=(n+a>>1)+7;switch(o&3){case 0:o++;break;case 2:o--;break;case 3:throw"Error"}return o};P.prototype.findAlignmentInRegion=function(e,t,r,i){var n=Math.floor(i*e);var a=Math.max(0,t-n);var o=Math.min(this.image.width-1,t+n);if(o-a<e*3){throw"Error"}var s=Math.max(0,r-n);var h=Math.min(this.image.height-1,r+n);var f=new u(this.image,a,s,o-a,h-s,e,this.resultPointCallback);return f.find()};P.prototype.createTransform=function(e,t,r,i,n){var a=n-3.5;var o;var s;var h;var f;if(i!=null){o=i.X;s=i.Y;h=f=a-3}else{o=t.X-e.X+r.X;s=t.Y-e.Y+r.Y;h=f=a}var w=M.quadrilateralToQuadrilateral(3.5,3.5,a,3.5,h,f,3.5,a,e.X,e.Y,t.X,t.Y,o,s,r.X,r.Y);return w};P.prototype.sampleGrid=function(e,t,r){var i=d;return i.sampleGrid3(e,r,t)};P.prototype.processFinderPatternInfo=function(e){var t=e.topLeft;var r=e.topRight;var i=e.bottomLeft;var n=this.calculateModuleSize(t,r,i);if(n<1){throw"Error"}var a=this.computeDimension(t,r,i,n);var o=f.getProvisionalVersionForDimension(a);var s=o.DimensionForVersion-7;var h=null;if(o.alignmentPatternCenters.length>0){var w=r.X-t.X+i.X;var l=r.Y-t.Y+i.Y;var u=1-3/s;var d=Math.floor(t.X+u*(w-t.X));var v=Math.floor(t.Y+u*(l-t.Y));for(var c=4;c<=16;c<<=1){h=this.findAlignmentInRegion(n,d,v,c);break}}var p=this.createTransform(t,r,i,h,a);var g=this.sampleGrid(this.image,p,a);var m;if(h==null){m=[i,t,r]}else{m=[i,t,r,h]}return new k(g,m)};P.prototype.detect=function(){var e=(new C).findFinderPattern(this.image);return this.processFinderPatternInfo(e)};function N(e,t){if(t==null||t.length==0){throw"System.ArgumentException"}this.field=e;var r=t.length;if(r>1&&t[0]==0){var i=1;while(i<r&&t[i]==0){i++}if(i==r){this.coefficients=e.Zero.coefficients}else{this.coefficients=new Array(r-i);for(var n=0;n<this.coefficients.length;n++)this.coefficients[n]=0;for(var a=0;a<this.coefficients.length;a++)this.coefficients[a]=t[i+a]}}else{this.coefficients=t}}Object.defineProperty(N.prototype,"Zero",{get:function(){return this.coefficients[0]==0}});Object.defineProperty(N.prototype,"Degree",{get:function(){return this.coefficients.length-1}});N.prototype.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]};N.prototype.evaluateAt=function(e){if(e==0){return this.getCoefficient(0)}var t=this.coefficients.length;if(e==1){var r=0;for(var i=0;i<t;i++){r=this.field.addOrSubtract(r,this.coefficients[i])}return r}var n=this.coefficients[0];for(var i=1;i<t;i++){n=this.field.addOrSubtract(this.field.multiply(e,n),this.coefficients[i])}return n};N.prototype.addOrSubtract=function(e){if(this.field!=e.field){throw"GF256Polys do not have same GF256 field"}if(this.Zero){return e}if(e.Zero){return this}var t=this.coefficients;var r=e.coefficients;if(t.length>r.length){var i=t;t=r;r=i}var n=new Array(r.length);var a=r.length-t.length;for(var o=0;o<a;o++)n[o]=r[o];for(var s=a;s<r.length;s++){n[s]=this.field.addOrSubtract(t[s-a],r[s])}return new N(this.field,n)};N.prototype.multiply1=function(e){if(this.field!=e.field){throw"GF256Polys do not have same GF256 field"}if(this.Zero||e.Zero){return this.field.Zero}var t=this.coefficients;var r=t.length;var i=e.coefficients;var n=i.length;var a=new Array(r+n-1);for(var o=0;o<r;o++){var s=t[o];for(var h=0;h<n;h++){a[o+h]=this.field.addOrSubtract(a[o+h],this.field.multiply(s,i[h]))}}return new N(this.field,a)};N.prototype.multiply2=function(e){if(e==0){return this.field.Zero}if(e==1){return this}var t=this.coefficients.length;var r=new Array(t);for(var i=0;i<t;i++){r[i]=this.field.multiply(this.coefficients[i],e)}return new N(this.field,r)};N.prototype.multiplyByMonomial=function(e,t){if(e<0){throw"System.ArgumentException"}if(t==0){return this.field.Zero}var r=this.coefficients.length;var i=new Array(r+e);for(var n=0;n<i.length;n++)i[n]=0;for(var n=0;n<r;n++){i[n]=this.field.multiply(this.coefficients[n],t)}return new N(this.field,i)};N.prototype.divide=function(e){if(this.field!=e.field){throw"GF256Polys do not have same GF256 field"}if(e.Zero){throw"Divide by 0"}var t=this.field.Zero;var r=this;var i=e.getCoefficient(e.Degree);var n=this.field.inverse(i);while(r.Degree>=e.Degree&&!r.Zero){var a=r.Degree-e.Degree;var o=this.field.multiply(r.getCoefficient(r.Degree),n);var s=e.multiplyByMonomial(a,o);var h=this.field.buildMonomial(a,o);t=t.addOrSubtract(h);r=r.addOrSubtract(s)}return[t,r]};function S(e){this.expTable=new Array(256);this.logTable=new Array(256);var t=1;for(var r=0;r<256;r++){this.expTable[r]=t;t<<=1;if(t>=256){t^=e}}for(var r=0;r<255;r++){this.logTable[this.expTable[r]]=r}var i=new Array(1);i[0]=0;this.zero=new N(this,new Array(i));var n=new Array(1);n[0]=1;this.one=new N(this,new Array(n))}Object.defineProperty(S.prototype,"Zero",{get:function(){return this.zero}});Object.defineProperty(S.prototype,"One",{get:function(){return this.one}});S.prototype.buildMonomial=function(e,t){if(e<0){throw"System.ArgumentException"}if(t==0){return this.zero}var r=new Array(e+1);for(var i=0;i<r.length;i++)r[i]=0;r[0]=t;return new N(this,r)};S.prototype.exp=function(e){return this.expTable[e]};S.prototype.log=function(e){if(e==0){throw"System.ArgumentException"}return this.logTable[e]};S.prototype.inverse=function(e){if(e==0){throw"System.ArithmeticException"}return this.expTable[255-this.logTable[e]]};S.prototype.addOrSubtract=function(e,t){return e^t};S.prototype.multiply=function(e,t){if(e==0||t==0){return 0}if(e==1){return t}if(t==1){return e}return this.expTable[(this.logTable[e]+this.logTable[t])%255]};S.QR_CODE_FIELD=new S(285);S.DATA_MATRIX_FIELD=new S(301);function B(e){this.field=e}B.prototype.decode=function(e,t){var r=new N(this.field,e);var i=new Array(t);for(var n=0;n<i.length;n++)i[n]=0;var a=false;var o=true;for(var n=0;n<t;n++){var s=r.evaluateAt(this.field.exp(a?n+1:n));i[i.length-1-n]=s;if(s!=0){o=false}}if(o){return}var h=new N(this.field,i);var f=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),h,t);var w=f[0];var l=f[1];var u=this.findErrorLocations(w);var d=this.findErrorMagnitudes(l,u,a);for(var n=0;n<u.length;n++){var v=e.length-1-this.field.log(u[n]);if(v<0){throw"ReedSolomonException Bad error location"}e[v]=S.addOrSubtract(e[v],d[n])}};B.prototype.runEuclideanAlgorithm=function(e,t,r){if(e.Degree<t.Degree){var i=e;e=t;t=i}var n=e;var a=t;var o=this.field.One;var s=this.field.Zero;var h=this.field.Zero;var f=this.field.One;while(a.Degree>=Math.floor(r/2)){var w=n;var l=o;var u=h;n=a;o=s;h=f;if(n.Zero){throw"r_{i-1} was zero"}a=w;var d=this.field.Zero;var v=n.getCoefficient(n.Degree);var c=this.field.inverse(v);while(a.Degree>=n.Degree&&!a.Zero){var p=a.Degree-n.Degree;var g=this.field.multiply(a.getCoefficient(a.Degree),c);d=d.addOrSubtract(this.field.buildMonomial(p,g));a=a.addOrSubtract(n.multiplyByMonomial(p,g))}s=d.multiply1(o).addOrSubtract(l);f=d.multiply1(h).addOrSubtract(u)}var m=f.getCoefficient(0);if(m==0){throw"ReedSolomonException sigmaTilde(0) was zero"}var b=this.field.inverse(m);var y=f.multiply2(b);var C=a.multiply2(b);return[y,C]};B.prototype.findErrorLocations=function(e){var t=e.Degree;if(t==1){return new Array(e.getCoefficient(1))}var r=new Array(t);var i=0;for(var n=1;n<256&&i<t;n++){if(e.evaluateAt(n)==0){r[i]=this.field.inverse(n);
i++}}if(i!=t){throw"Error locator degree does not match number of roots"}return r};B.prototype.findErrorMagnitudes=function(e,t,r){var i=t.length;var n=new Array(i);for(var a=0;a<i;a++){var o=this.field.inverse(t[a]);var s=1;for(var h=0;h<i;h++){if(a!=h){s=this.field.multiply(s,S.addOrSubtract(1,this.field.multiply(t[h],o)))}}n[a]=this.field.multiply(e.evaluateAt(o),this.field.inverse(s));if(r){n[a]=this.field.multiply(n[a],o)}}return n};var A={};A.forReference=function(e){if(e<0||e>7){throw"System.ArgumentException"}return A.DATA_MASKS[e]};function E(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++){for(var i=0;i<t;i++){if(this.isMasked(r,i)){e.flip(i,r)}}}};this.isMasked=function(e,t){return(e+t&1)==0}}function D(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++){for(var i=0;i<t;i++){if(this.isMasked(r,i)){e.flip(i,r)}}}};this.isMasked=function(e,t){return(e&1)==0}}function x(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++){for(var i=0;i<t;i++){if(this.isMasked(r,i)){e.flip(i,r)}}}};this.isMasked=function(e,t){return t%3==0}}function F(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++){for(var i=0;i<t;i++){if(this.isMasked(r,i)){e.flip(i,r)}}}};this.isMasked=function(e,t){return(e+t)%3==0}}function O(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++){for(var i=0;i<t;i++){if(this.isMasked(r,i)){e.flip(i,r)}}}};this.isMasked=function(e,t){return(q(e,1)+t/3&1)==0}}function I(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++){for(var i=0;i<t;i++){if(this.isMasked(r,i)){e.flip(i,r)}}}};this.isMasked=function(e,t){var r=e*t;return(r&1)+r%3==0}}function R(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++){for(var i=0;i<t;i++){if(this.isMasked(r,i)){e.flip(i,r)}}}};this.isMasked=function(e,t){var r=e*t;return((r&1)+r%3&1)==0}}function V(){this.unmaskBitMatrix=function(e,t){for(var r=0;r<t;r++){for(var i=0;i<t;i++){if(this.isMasked(r,i)){e.flip(i,r)}}}};this.isMasked=function(e,t){return((e+t&1)+e*t%3&1)==0}}A.DATA_MASKS=[new E,new D,new x,new F,new O,new I,new R,new V];function z(e){var t=e.Dimension;if(t<21||(t&3)!=1){throw"Error BitMatrixParser"}this.bitMatrix=e;this.parsedVersion=null;this.parsedFormatInfo=null}z.prototype.copyBit=function(e,t,r){return this.bitMatrix.get_Renamed(e,t)?r<<1|1:r<<1};z.prototype.readFormatInformation=function(){if(this.parsedFormatInfo!=null){return this.parsedFormatInfo}var e=0;for(var t=0;t<6;t++){e=this.copyBit(t,8,e)}e=this.copyBit(7,8,e);e=this.copyBit(8,8,e);e=this.copyBit(8,7,e);for(var r=5;r>=0;r--){e=this.copyBit(8,r,e)}this.parsedFormatInfo=a.decodeFormatInformation(e);if(this.parsedFormatInfo!=null){return this.parsedFormatInfo}var i=this.bitMatrix.Dimension;e=0;var n=i-8;for(var t=i-1;t>=n;t--){e=this.copyBit(t,8,e)}for(var r=i-7;r<i;r++){e=this.copyBit(8,r,e)}this.parsedFormatInfo=a.decodeFormatInformation(e);if(this.parsedFormatInfo!=null){return this.parsedFormatInfo}throw"Error readFormatInformation"};z.prototype.readVersion=function(){if(this.parsedVersion!=null){return this.parsedVersion}var e=this.bitMatrix.Dimension;var t=e-17>>2;if(t<=6){return f.getVersionForNumber(t)}var r=0;var i=e-11;for(var n=5;n>=0;n--){for(var a=e-9;a>=i;a--){r=this.copyBit(a,n,r)}}this.parsedVersion=f.decodeVersionInformation(r);if(this.parsedVersion!=null&&this.parsedVersion.DimensionForVersion==e){return this.parsedVersion}r=0;for(var a=5;a>=0;a--){for(var n=e-9;n>=i;n--){r=this.copyBit(a,n,r)}}this.parsedVersion=f.decodeVersionInformation(r);if(this.parsedVersion!=null&&this.parsedVersion.DimensionForVersion==e){return this.parsedVersion}throw"Error readVersion"};z.prototype.readCodewords=function(){var e=this.readFormatInformation();var t=this.readVersion();var r=A.forReference(e.dataMask);var i=this.bitMatrix.Dimension;r.unmaskBitMatrix(this.bitMatrix,i);var n=t.buildFunctionPattern();var a=true;var o=new Array(t.totalCodewords);var s=0;var h=0;var f=0;for(var w=i-1;w>0;w-=2){if(w==6){w--}for(var l=0;l<i;l++){var u=a?i-1-l:l;for(var d=0;d<2;d++){if(!n.get_Renamed(w-d,u)){f++;h<<=1;if(this.bitMatrix.get_Renamed(w-d,u)){h|=1}if(f==8){o[s++]=h;f=0;h=0}}}}a^=true}if(s!=t.totalCodewords){throw"Error readCodewords"}return o};function T(e,t){this.numDataCodewords=e;this.codewords=t}T.getDataBlocks=function(e,t,r){if(e.length!=t.totalCodewords){throw"ArgumentException"}var i=t.getECBlocksForLevel(r);var n=0;var a=i.getECBlocks();for(var o=0;o<a.length;o++){n+=a[o].count}var s=new Array(n);var h=0;for(var f=0;f<a.length;f++){var w=a[f];for(var o=0;o<w.count;o++){var l=w.dataCodewords;var u=i.ecCodewordsPerBlock+l;s[h++]=new T(l,new Array(u))}}var d=s[0].codewords.length;var v=s.length-1;while(v>=0){var c=s[v].codewords.length;if(c==d){break}v--}v++;var p=d-i.ecCodewordsPerBlock;var g=0;for(var o=0;o<p;o++){for(var f=0;f<h;f++){s[f].codewords[o]=e[g++]}}for(var f=v;f<h;f++){s[f].codewords[p]=e[g++]}var m=s[0].codewords.length;for(var o=p;o<m;o++){for(var f=0;f<h;f++){var b=f<v?o:o+1;s[f].codewords[b]=e[g++]}}return s};function L(e,t,r){this.blockPointer=0;this.bitPointer=7;this.dataLength=0;this.blocks=e;this.numErrorCorrectionCode=r;if(t<=9)this.dataLengthMode=0;else if(t>=10&&t<=26)this.dataLengthMode=1;else if(t>=27&&t<=40)this.dataLengthMode=2}L.prototype.getNextBits=function(e){var t=0;if(e<this.bitPointer+1){var r=0;for(var i=0;i<e;i++){r+=1<<i}r<<=this.bitPointer-e+1;t=(this.blocks[this.blockPointer]&r)>>this.bitPointer-e+1;this.bitPointer-=e;return t}else if(e<this.bitPointer+1+8){var n=0;for(var i=0;i<this.bitPointer+1;i++){n+=1<<i}t=(this.blocks[this.blockPointer]&n)<<e-(this.bitPointer+1);this.blockPointer++;t+=this.blocks[this.blockPointer]>>8-(e-(this.bitPointer+1));this.bitPointer=this.bitPointer-e%8;if(this.bitPointer<0){this.bitPointer=8+this.bitPointer}return t}else if(e<this.bitPointer+1+16){var n=0;var a=0;for(var i=0;i<this.bitPointer+1;i++){n+=1<<i}var o=(this.blocks[this.blockPointer]&n)<<e-(this.bitPointer+1);this.blockPointer++;var s=this.blocks[this.blockPointer]<<e-(this.bitPointer+1+8);this.blockPointer++;for(var i=0;i<e-(this.bitPointer+1+8);i++){a+=1<<i}a<<=8-(e-(this.bitPointer+1+8));var h=(this.blocks[this.blockPointer]&a)>>8-(e-(this.bitPointer+1+8));t=o+s+h;this.bitPointer=this.bitPointer-(e-8)%8;if(this.bitPointer<0){this.bitPointer=8+this.bitPointer}return t}else{return 0}};L.prototype.NextMode=function(){if(this.blockPointer>this.blocks.length-this.numErrorCorrectionCode-2)return 0;else return this.getNextBits(4)};L.prototype.getDataLength=function(e){var t=0;while(true){if(e>>t==1)break;t++}return this.getNextBits(Y.sizeOfDataLengthInfo[this.dataLengthMode][t])};L.prototype.getRomanAndFigureString=function(e){var t=e;var r=0;var i="";var n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];do{if(t>1){r=this.getNextBits(11);var a=Math.floor(r/45);var o=r%45;i+=n[a];i+=n[o];t-=2}else if(t==1){r=this.getNextBits(6);i+=n[r];t-=1}}while(t>0);return i};L.prototype.getFigureString=function(e){var t=e;var r=0;var i="";do{if(t>=3){r=this.getNextBits(10);if(r<100)i+="0";if(r<10)i+="0";t-=3}else if(t==2){r=this.getNextBits(7);if(r<10)i+="0";t-=2}else if(t==1){r=this.getNextBits(4);t-=1}i+=r}while(t>0);return i};L.prototype.get8bitByteArray=function(e){var t=e;var r=0;var i=[];do{r=this.getNextBits(8);i.push(r);t--}while(t>0);return i};L.prototype.getKanjiString=function(e){var t=e;var r=0;var i="";do{r=this.getNextBits(13);var n=r%192;var a=r/192;var o=(a<<8)+n;var s=0;if(o+33088<=40956){s=o+33088}else{s=o+49472}i+=String.fromCharCode(s);t--}while(t>0);return i};Object.defineProperty(L.prototype,"DataByte",{get:function(){var e=[];var t=1;var r=2;var i=4;var n=8;do{var a=this.NextMode();if(a==0){if(e.length>0)break;else throw"Empty data block"}if(a!=t&&a!=r&&a!=i&&a!=n){throw"Invalid mode: "+a+" in (block:"+this.blockPointer+" bit:"+this.bitPointer+")"}var o=this.getDataLength(a);if(o<1)throw"Invalid data length: "+o;switch(a){case t:var s=this.getFigureString(o);var h=new Array(s.length);for(var f=0;f<s.length;f++)h[f]=s.charCodeAt(f);e.push(h);break;case r:var s=this.getRomanAndFigureString(o);var h=new Array(s.length);for(var f=0;f<s.length;f++)h[f]=s.charCodeAt(f);e.push(h);break;case i:var w=this.get8bitByteArray(o);e.push(w);break;case n:var s=this.getKanjiString(o);e.push(s);break}}while(true);return e}});var X={};X.rsDecoder=new B(S.QR_CODE_FIELD);X.correctErrors=function(e,t){var r=e.length;var i=new Array(r);for(var n=0;n<r;n++){i[n]=e[n]&255}var a=e.length-t;try{X.rsDecoder.decode(i,a)}catch(o){throw o}for(var n=0;n<t;n++){e[n]=i[n]}};X.decode=function(e){var t=new z(e);var r=t.readVersion();var i=t.readFormatInformation().errorCorrectionLevel;var n=t.readCodewords();var a=T.getDataBlocks(n,r,i);var o=0;for(var s=0;s<a.length;s++){o+=a[s].numDataCodewords}var h=new Array(o);var f=0;for(var w=0;w<a.length;w++){var l=a[w];var u=l.codewords;var d=l.numDataCodewords;X.correctErrors(u,d);for(var s=0;s<d;s++){h[f++]=u[s]}}var v=new L(h,r.versionNumber,i.bits);return v};var Y={};Y.sizeOfDataLengthInfo=[[10,9,8,8],[12,11,16,10],[14,13,16,12]];function _(){this.imagedata=null;this.width=0;this.height=0;this.qrCodeSymbol=null;this.debug=false;this.callback=null}_.prototype.decode=function(e,t){var r=function(){try{this.error=undefined;this.result=this.process(this.imagedata)}catch(e){this.error=e;this.result=undefined}if(this.callback!=null){this.callback(this.error,this.result)}return this.result}.bind(this);if(e!=undefined&&e.width!=undefined){this.width=e.width;this.height=e.height;this.imagedata={data:t||e.data};this.imagedata.width=e.width;this.imagedata.height=e.height;r()}else{var i=new Image;i.crossOrigin="Anonymous";i.onload=function(){var e=document.createElement("canvas");var t=e.getContext("2d");var n=document.getElementById("out-canvas");if(n!=null){var a=n.getContext("2d");a.clearRect(0,0,320,240);a.drawImage(i,0,0,320,240)}e.width=i.width;e.height=i.height;t.drawImage(i,0,0);this.width=i.width;this.height=i.height;try{this.imagedata=t.getImageData(0,0,i.width,i.height)}catch(o){this.result="Cross domain image reading not supported in your browser! Save it to your computer then drag and drop the file!";if(this.callback!=null)return this.callback(null,this.result)}r()}.bind(this);i.src=e}};_.prototype.decode_utf8=function(e){try{return decodeURIComponent(escape(e))}catch(t){return e}};_.prototype.process=function(e){var t=(new Date).getTime();var r=this.grayScaleToBitmap(this.grayscale(e));var i=new P(r);var n=i.detect();var a=X.decode(n.bits);var o=a.DataByte;var s="";for(var h=0;h<o.length;h++){for(var f=0;f<o[h].length;f++)s+=String.fromCharCode(o[h][f])}var w=(new Date).getTime();var l=w-t;if(this.debug){console.log("QR Code processing time (ms): "+l)}return{result:this.decode_utf8(s),points:n.points}};_.prototype.getPixel=function(e,t,r){if(e.width<t){throw"point error"}if(e.height<r){throw"point error"}var i=t*4+r*e.width*4;return(e.data[i]*33+e.data[i+1]*34+e.data[i+2]*33)/100};_.prototype.binarize=function(e){var t=new Array(this.width*this.height);for(var r=0;r<this.height;r++){for(var i=0;i<this.width;i++){var n=this.getPixel(i,r);t[i+r*this.width]=n<=e}}return t};_.prototype.getMiddleBrightnessPerArea=function(e){var t=4;var r=Math.floor(e.width/t);var i=Math.floor(e.height/t);var n=new Array(t);for(var a=0;a<t;a++){n[a]=new Array(t);for(var o=0;o<t;o++){n[a][o]=[0,0]}}for(var s=0;s<t;s++){for(var h=0;h<t;h++){n[h][s][0]=255;for(var f=0;f<i;f++){for(var w=0;w<r;w++){var l=e.data[r*h+w+(i*s+f)*e.width];if(l<n[h][s][0])n[h][s][0]=l;if(l>n[h][s][1])n[h][s][1]=l}}}}var u=new Array(t);for(var d=0;d<t;d++){u[d]=new Array(t)}for(var s=0;s<t;s++){for(var h=0;h<t;h++){u[h][s]=Math.floor((n[h][s][0]+n[h][s][1])/2)}}return u};_.prototype.grayScaleToBitmap=function(e){var t=this.getMiddleBrightnessPerArea(e);var r=t.length;var i=Math.floor(e.width/r);var n=Math.floor(e.height/r);for(var a=0;a<r;a++){for(var o=0;o<r;o++){for(var s=0;s<n;s++){for(var h=0;h<i;h++){e.data[i*o+h+(n*a+s)*e.width]=e.data[i*o+h+(n*a+s)*e.width]<t[o][a]}}}}return e};_.prototype.grayscale=function(e){var t=new Array(e.width*e.height);for(var r=0;r<e.height;r++){for(var i=0;i<e.width;i++){var n=this.getPixel(e,i,r);t[i+r*e.width]=n}}return{height:e.height,width:e.width,data:t}};function q(e,t){if(e>=0)return e>>t;else return(e>>t)+(2<<~t)}return _});